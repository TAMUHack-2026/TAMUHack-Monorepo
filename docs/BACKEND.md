# Database

This project uses a PostgreSQL database to store user data and profile information.
There are two databases:

* The development database running in a Docker container for local development.
* The production database hosted on Supabase.

Both databases utilize the same schema defined in `backend/supabase/migrations/schema.sql`.

## Database Layout

The database is simple and is structured with the following tables (values are non-null unless otherwise specified):
* `users`: Stores user information such as their id, email, and hashed password.
  * Columns:
    * `id` (this is the primary key)
    * `email` (must be valid email format)
    * `password_hash` (this should be a modern hash of the user's password)
* `profiles`: Stores user profile data needed for the machine learning model's predictions.
  * Columns:
    * `id` (this is the primary key)
    * `first_name`
    * `last_name`
    * `age` (must be between 0 and 150)
    * `sex` (must be either 'male' or 'female' and is case-sensitive, so applications should normalize input)
    * `gender_identity` (optional)
    * `height_in` (4 digits with 2-decimal precision, positive)
    * `weight_lbs` (5 digits with 2-decimal precision, positive)

Both tables share the same primary key `id`,
which is a UUID generated by PostgreSQL when a new user is created.

## Querying the Database

Services should ***NEVER*** query the database directly.
Instead, all database interactions should be done through the User Management API,
which provides endpoints for creating, reading, updating, and deleting user and profile data.

## User Management API

> Instructions for how to run the User Management API, as well as other backend services can be found in the repository [README.md](../README.md) file.

The User Management API is a RESTful API built using Spring Boot.
This API is used to interact with the PostgreSQL database for all user-related operations.
This API is also a gateway to the Model API for making inference calls to the machine learning model.
To view the documentation for the API, as well as test endpoints, run the backend service and navigate to [http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html).

## Model API

> Instructions for how to run the Model API, as well as other backend services can be found in the repository [README.md](../README.md) file.

The Model API is a RESTful API built using FastAPI.
This API is used to make inference calls to the machine learning model.
To view the documentation for the API, as well as test endpoints, run the backend service and navigate to [http://localhost:8090/swagger-ui.html](http://localhost:8090/docs).

The model API will **NEVER** be called from the frontned directly. It is **ONLY** called from the User Management API.
Inference requests are sent first to the User Management API, which then forwards the request to the Model API.
